# epoxy-visibility-tracker-issue
Epoxy provides a way to track [Visibility-Events](https://github.com/airbnb/epoxy/wiki/Visibility-Events)  
On our screen we display an EpoxyRecyclerView with PagerSnapHelper and horizontal layout which displays a simple [controller](https://github.com/silentnuke/epoxy-visibility-tracker-issue/blob/master/app/src/main/java/com/silentnuke/epoxyvisibilitytracker/FeedController.kt) which contains a list of [Images](https://github.com/silentnuke/epoxy-visibility-tracker-issue/blob/master/app/src/main/java/com/silentnuke/epoxyvisibilitytracker/ImageModel.kt) and [LoadingMore](https://github.com/silentnuke/epoxy-visibility-tracker-issue/blob/master/app/src/main/java/com/silentnuke/epoxyvisibilitytracker/LoadingMoreModel.kt) view. Also, below the EpoxyRecyclerView we have a static panel which depends on the current page and may be in 3 states: `CONTENT`, `LOADING`, `ERROR`.  
[LoadingMore]((https://github.com/silentnuke/epoxy-visibility-tracker-issue/blob/master/app/src/main/java/com/silentnuke/epoxyvisibilitytracker/LoadingMoreModel.kt)) view have 3 states: `IDLE`, `LOADING`, `ERROR`.  
If `LoadingMore` is currently visible and state changes from one to another, new LoadingMoreModel is created and then `bind` is called. However `onVisibilityStateChanged` is not tiggered for new model and this leads to incorrect state for the bottom panel.  
For example: We currently have visible `LoadingMore` model in `LOADING` state. When load more request fails, we update controler with `ERROR` state  for `LoadingMore` model. This creates a new `LoadingMore` model, however after bind is called `onVisibilityStateChanged` event is not called for new `LoadingMore` model. This could be workaround if we use different [id](https://github.com/silentnuke/epoxy-visibility-tracker-issue/blob/master/app/src/main/java/com/silentnuke/epoxyvisibilitytracker/FeedController.kt#L19) for different states of `LoadingMore` or if we create [2 separate models](https://github.com/silentnuke/epoxy-visibility-tracker-issue/pull/1/files#diff-77f69fb42769af9b3cef8fd537964a82R17) and we can continues to use 1 id.  

| Actual  | Expected |
| ------------- | ------------- |
| <img src="https://github.com/silentnuke/epoxy-visibility-tracker-issue/blob/master/screens/actual.gif" width="300" height="600" />  | <img src="https://github.com/silentnuke/epoxy-visibility-tracker-issue/blob/master/screens/expected.gif" width="300" height="600" />  |  
